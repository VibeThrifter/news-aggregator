# Story 6.1: Category Filter Navigation on Homepage

**Epic ID:** Epic 6 – UX & Navigation Enhancements
**Status:** Ready for Development

## Objective

Allow users to filter news events by category using a professional, NOS/NU.nl-style horizontal navigation bar on the homepage, with URL-based state for shareability.

## Background/Context

- **Source:** User request for category-based filtering on homepage.
- **Reference:** Backend already classifies articles via LLM into categories (legal, politics, crime, sports, international, business, entertainment, weather, royal, other) in `backend/app/nlp/classify.py`.
- **Design inspiration:** [NOS.nl](https://nos.nl) horizontal category tabs, [NU.nl](https://nu.nl) pill-style navigation.
- **Current State:** `EventFeed.tsx` fetches all events via `/api/v1/events`. Events have `event_type` field from backend but it's not exposed in API response or used in frontend.

### Target Paths

| Layer | Files |
|-------|-------|
| Backend | `backend/app/routers/events.py`, `backend/app/repositories/event_repo.py` |
| Frontend | `frontend/components/CategoryNav.tsx` (new), `frontend/components/EventFeed.tsx`, `frontend/app/page.tsx` |

---

## Design Specification

```
┌─────────────────────────────────────────────────────────────────────┐
│  360° Nieuws                                              [Refresh] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────┐ ┌──────────┐ ┌─────────┐ ┌───────┐ ┌───────┐ ┌─────────┐  │
│  │Alles│ │Binnenland│ │Buitenland│ │Sport │ │Cultuur│ │Misdaad  │  │
│  └─────┘ └──────────┘ └─────────┘ └───────┘ └───────┘ └─────────┘  │
│    ▲ active (underline + bold)                                      │
│                                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │ Event Card 1                                                    ││
│  │ [category badge] Title...                                       ││
│  └─────────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │ Event Card 2                                                    ││
│  └─────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘
```

---

## UI/UX Requirements

### 1. Navigation Style (NOS-inspired)

- Horizontal scrollable tab bar under header
- "Alles" (All) as default/first option - shows all events
- **Active tab:** bold text, colored underline (brand color), no background change
- **Inactive tabs:** regular weight, subtle hover effect
- **Mobile:** horizontally scrollable with fade edges, no wrapping
- **Desktop:** centered tabs with even spacing

### 2. Category Mapping

| Backend `event_type` | Dutch Label | Color |
|---------------------|-------------|-------|
| (all) | Alles | - |
| politics | Politiek | `blue-500` |
| international | Buitenland | `purple-500` |
| crime | Misdaad | `red-500` |
| sports | Sport | `green-500` |
| entertainment | Cultuur | `pink-500` |
| business | Economie | `amber-500` |
| legal | Rechtszaken | `indigo-500` |
| weather | Weer | `cyan-500` |
| royal | Koningshuis | `orange-500` |
| other | Overig | `slate-500` |

### 3. Performance Requirements

- Client-side filtering initially (filter already-loaded events)
- No loading flash when switching categories
- Preserve scroll position when changing category
- URL query param `?category=politics` for shareability
- Browser back/forward navigation support

### 4. Category Badge on Cards

- Small colored badge/pill showing category on each EventCard
- Consistent color per category (see table above)
- Subtle, not overwhelming the card design

---

## Acceptance Criteria

| # | Given | When | Then |
|---|-------|------|------|
| 1 | The homepage | It loads | A horizontal category navigation bar displays below the header with "Alles" selected by default showing all events |
| 2 | A user | Clicks a category tab (e.g., "Politiek") | The event feed filters instantly to show only events of that category, the tab becomes active, and URL updates to `?category=politics` |
| 3 | A URL with `?category=crime` | The page loads | The "Misdaad" tab is active and only crime events are displayed |
| 4 | The viewport is mobile (<768px) | Viewing the category bar | Tabs are horizontally scrollable with smooth scroll behavior |
| 5 | An event card | Is rendered | It displays a small category badge with the Dutch category label |
| 6 | A category with zero events | Is selected | An empty state message appears: "Geen events in deze categorie." |

---

## Subtask Checklist

### Backend

- [ ] Extend `/api/v1/events` endpoint to accept optional `?category=<type>` query parameter for server-side filtering
- [ ] Add `event_type` field to events API response model if not already present
- [ ] Write integration test for category filter endpoint

### Frontend

- [ ] Create `frontend/components/CategoryNav.tsx` component with horizontal scrollable tabs
- [ ] Implement category state management using URL search params (`useSearchParams` from Next.js)
- [ ] Update `EventFeed.tsx` to read category from URL and filter events
- [ ] Add category badge to `EventCard.tsx` with color coding
- [ ] Create `frontend/lib/categories.ts` with category mapping (slug → Dutch label → color)
- [ ] Style navigation bar with Tailwind:
  - Fixed position under header (sticky)
  - Horizontal scroll on mobile with `-webkit-overflow-scrolling: touch`
  - Smooth transitions for active state
  - Dark mode compatible
- [ ] Add empty state for categories with no events
- [ ] Ensure keyboard navigation (arrow keys, enter to select)
- [ ] Add Playwright E2E test for category filtering (`@category-filter` tag)

### Accessibility

- [ ] Ensure `role="tablist"`, `role="tab"`, `aria-selected` attributes

### Documentation

- [ ] Update README with category filter documentation

### Verification

- [ ] Run `npm run lint`, `npm run test`, and Playwright tests

---

## Testing Requirements

| Type | Description |
|------|-------------|
| Backend Integration | Test for `/api/v1/events?category=politics` returning filtered results |
| Frontend Unit | Jest tests for CategoryNav component rendering states |
| E2E | Playwright test verifying category switching updates URL and filters events |
| Accessibility | aXe or manual check for keyboard navigation and ARIA attributes |

**Definition of Done:** ACs met, all tests passing, responsive design verified on mobile/desktop.

---

## Technical Notes

### URL State Management

```typescript
// Use Next.js App Router useSearchParams()
import { useSearchParams, useRouter } from 'next/navigation';

const searchParams = useSearchParams();
const category = searchParams.get('category') ?? 'all';
```

### Category Configuration

```typescript
// frontend/lib/categories.ts
export const CATEGORIES = [
  { slug: 'all', label: 'Alles', color: null },
  { slug: 'politics', label: 'Politiek', color: 'blue' },
  { slug: 'international', label: 'Buitenland', color: 'purple' },
  // ...
] as const;
```

### Implementation Strategy

1. **Initial implementation:** Client-side filter (filter already-loaded events)
2. **Future optimization:** Server-side if dataset grows (>100 events)
3. **Stretch goal:** Category counts in tabs (requires additional API data)

---

## Story Wrap Up

*(To be filled in AFTER implementation)*

- **Agent Model Used:** _pending_
- **Date/Time Completed:** _pending_
- **Commit Hash:** _pending_
- **Change Log:** _pending_
