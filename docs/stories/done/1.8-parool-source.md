# Story 1.8: Add Het Parool as News Source

**Story ID:** 1.8
**Epic ID:** Epic 1 â€“ RSS Ingestion & NLP Enrichment
**Status:** Done

## Objective

Add Het Parool as a news source to include Amsterdam-focused regional perspective with progressive editorial stance.

## Background/Context

- **Source:** Het Parool is Amsterdam's quality daily newspaper (DPG Media)
- **RSS Feed:** `https://www.parool.nl/rss.xml` (to be verified)
- **Fetch Strategy:** To be determined - likely similar to Volkskrant (same publisher)
- **Paywall:** Has premium articles behind paywall
- **Value:** Regional Amsterdam focus, progressive perspective, local news coverage
- **Publisher:** DPG Media (same as NU.nl, AD.nl, Volkskrant)
- **Reference:** `source_profiles.yaml`, Story 1.7 (Volkskrant - same publisher)

### RSS Feed Analysis

```
Feed URL: https://www.parool.nl/rss.xml (verify)
Alternative: https://www.parool.nl/voorpagina/rss.xml
Publisher: DPG Media
```

### DPG Privacy-Wall Aanpak (Learnings from Story 1.7 Volkskrant)

DPG Media sites (NU.nl, AD, Volkskrant, Parool, Trouw) hebben een privacy-gate die consent vereist voordat artikelen geladen kunnen worden. De bewezen aanpak:

1. **Fetch Strategy:** `playwright` (niet `simple`)
2. **Consent Flow:**
   - Eerst naar homepage navigeren (`https://www.parool.nl/`)
   - Wacht op consent dialog
   - Klik "Akkoord" button via selector `button:has-text('Akkoord')`
   - Dan pas naar artikel URL navigeren
   - Cookies worden bewaard in browser context
3. **Parser:** `trafilatura` werkt goed na consent
4. **Expected output:** ~5000-6000 chars per artikel

**source_profiles.yaml configuratie:**
```yaml
parool_rss:
  feed_url: https://www.parool.nl/voorpagina/rss.xml
  fetch_strategy: playwright
  user_agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
  parser: trafilatura
  requires_js: true
  cookie_ttl_minutes: 0
```

## Acceptance Criteria (AC)

- [ ] Given the Parool RSS feed URL when the scheduler polls, then new articles are discovered and stored in the database.
- [ ] Given a non-premium Parool article URL when fetched, then full article text is extracted (>500 chars typical).
- [ ] Given a premium Parool article URL when fetched, then system gracefully handles paywall (use RSS summary or skip).
- [ ] Given DPG consent dialog when fetching, then consent is automatically handled.
- [ ] Given Parool articles in the database when event clustering runs, then they are clustered with articles from other sources.
- [ ] Given existing sources when Parool is added, then they continue working without regression.

## Subtask Checklist

### Research & Testing
- [ ] Verify RSS feed URL exists and returns valid feed
- [ ] Test RSS feed parsing with existing feed reader
- [ ] Test article fetch with simple httpx (check if JS rendering needed)
- [ ] Test if DPG consent flow applies (reuse Volkskrant findings)

### Configuration
- [ ] Add `parool_rss` source profile to `source_profiles.yaml`
- [ ] Configure fetch strategy (likely same as Volkskrant)
- [ ] Set appropriate user agent header
- [ ] Configure consent handling (reuse DPG pattern)

### Paywall Handling
- [ ] Implement paywall detection (reuse Volkskrant pattern if applicable)
- [ ] Graceful fallback to RSS summary for premium articles
- [ ] Log paywall encounters for monitoring

### Testing & Validation
- [ ] Test article fetch with non-premium article
- [ ] Test paywall handling with premium article
- [ ] Run manual ingestion to verify articles are stored
- [ ] Verify articles cluster with same-topic articles from other sources

## Testing Requirements

- **Manual test:** Fetch sample Parool article, verify content extraction
- **Paywall test:** Verify graceful handling of premium articles
- **Integration test:** Run ingestion cycle, verify articles in database
- **Clustering test:** Verify articles cluster with other sources
- **Definition of Done:** Parool articles (non-premium) successfully ingested and clustered

## Technical Notes

- Same DPG Media infrastructure as Volkskrant - implementation should be very similar
- Leverage learnings from Story 1.7 (Volkskrant)
- Regional focus means some articles may only cluster with local Amsterdam news
- Consider implementing after Volkskrant to reuse patterns

## Dependencies

- Story 1.7 (Volkskrant) - recommended to complete first for DPG pattern reuse
- Story 1.4 (Playwright scraping) - complete (if needed)
- Existing RSS ingestion pipeline - operational

## Story Wrap Up

- **Agent Model Used:** Claude Opus 4.5
- **Agent Credit or Cost:** ~$0.50
- **Date/Time Completed:** 2025-12-06
- **Commit Hash:** 70b7753
- **Change Log:**
  - Created `backend/app/feeds/parool.py` - Feed reader class
  - Added `rss_parool_url` to `backend/app/core/config.py`
  - Added `parool_rss` source profile to `source_profiles.yaml` (Playwright strategy)
  - Added `parool.nl` to DPG domains in `playwright_fetch.py` for homepage-first consent
  - Registered reader in `backend/app/services/ingest_service.py`
  - Updated unit tests in `backend/tests/unit/test_feeds.py` (7 readers)
  - Verified: Articles ingested with ~12000 chars content each via Playwright
